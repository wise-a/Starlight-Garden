<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starlight Garden v1.2</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="container">
        <h1>Starlight Garden</h1>
        <div class="controls">
            <button onclick="saveGame()">ðŸ’¾ Save Game (.txt)</button>
            <label for="loadInput" class="btn">ðŸ“‚ Load Game (.txt)</label>
            <input type="file" id="loadInput" accept=".txt" onchange="loadGame(this)">
        </div>
        
        <canvas id="gameCanvas" width="640" height="480"></canvas>
        
        <div class="hud">
            <p><strong>Arrow Keys</strong> to Move | <strong>Space</strong> to Plant/Water/Harvest</p>
            <div class="stats-bar">
                <span id="status">Seeds: 5 | Water: 10</span>
                <span id="score-display">Harvested: 0</span>
                <span id="regen-timer" style="color: #aaa; font-size: 0.8em;">(Checking...)</span>
            </div>
        </div>
        <div id="message-area"></div>
    </div>

<script>
/**
 * GAME CONSTANTS & STATE
 */
const TILE_SIZE = 32;
const COLS = 20;
const ROWS = 15;

const COLORS = {
    0: '#2d4a3e', // Grass
    1: '#595652', // Rock
    2: '#4da6ff', // Water
    player: '#ffcc00', // Player
    plant_seed: '#8fbc8f',
    plant_bloom: '#ff99cc'
};

// Default State
let gameState = {
    meta: { version: "1.2", timestamp: Date.now() },
    player: { x: 1, y: 1, seeds: 5, water: 10, score: 0 },
    world: {
        width: COLS,
        height: ROWS,
        map: Array(ROWS).fill().map(() => Array(COLS).fill(0)), 
        plants: [] 
    }
};

// Water Regeneration Logic
let waterTimer = 0;
setInterval(() => {
    const p = gameState.player;
    
    // Check if there are ANY plants in the ground (seeds or blooms)
    const hasActiveCrops = gameState.world.plants.length > 0
